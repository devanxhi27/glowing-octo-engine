<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Load Moment.js for date handling -->
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <!-- Load Lucide icons (open-source vector icons) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
       tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'background': '#0d0d21',   // Very deep, dark blue/black
                        'surface': '#1a1a36',      // Darker card background
                        'accent-1': '#00ffff',     // NEON CYAN/BLUE (Primary accent)
                        'accent-2': '#ff00aa',     // NEON PINK/MAGENTA (Secondary/Alert accent)
                        'sidebar-start': '#0d0d21',// Matches background for smooth sidebar start
                        'sidebar-end': '#4d0099',  // Deep Violet/Purple for gradient end
                        'text-light': '#f0f8ff',   // Crisp white/azure
                        'text-muted': '#8b8c9d',   // Muted gray for secondary text
                        'chart-green': '#39ff14',  // NEON LIME GREEN (Success/ROI)
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for dark theme */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e274a;
        }
        ::-webkit-scrollbar-thumb {
            background: #4c1d95;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #3b82f6;
        }
    </style>
    <!-- Firebase/Firestore boilerplate -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        window.db = null;
        window.auth = null;

        async function initFirebase() {
            if (!firebaseConfig) {
                console.warn("Firebase config not found. Running in mock data mode.");
                return;
            }
            try {
                setLogLevel('error');
                const app = initializeApp(firebaseConfig);
                window.db = getFirestore(app);
                window.auth = getAuth(app);

                if (initialAuthToken) {
                    await signInWithCustomToken(window.auth, initialAuthToken);
                } else {
                    await signInAnonymously(window.auth);
                }
                // console.log("Firebase initialized and authenticated.");
            } catch (error) {
                console.error("Firebase initialization or sign-in failed:", error);
            }
        }
        window.initFirebase = initFirebase;
    </script>
</head>
<body class="bg-background text-text-light flex min-h-screen relative">

    <!-- Mobile Sidebar Overlay (Visible only on small screens when menu is open) -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-background bg-opacity-70 z-40 hidden md:hidden transition-opacity duration-300" onclick="toggleSidebar()"></div>

    <!-- Sidebar (Now uses fixed positioning for mobile off-canvas behavior) -->
    <div id="sidebar" class="fixed inset-y-0 left-0 z-50 w-64 bg-sidebar-start bg-gradient-to-br from-sidebar-start to-sidebar-end text-white shadow-2xl p-4 
        transform -translate-x-full md:translate-x-0 transition-transform duration-300 
        md:static md:flex md:flex-col md:h-screen">
        
        <a href="clients.html">
            <div class="flex items-center space-x-3 mb-8 p-2">
                <div class="p-2 rounded-full bg-white bg-opacity-20">
                    <i data-lucide="zap" class="w-6 h-6 text-accent-1"></i>
                </div>
                <h2 class="text-xl font-bold tracking-wider">DASHBOARD</h2>
            </div>
        </a>

        <nav class="space-y-2 flex-grow">
            <!-- Navigation Links -->
            <a href="#" class="sidebar-link flex items-center space-x-3 p-3 rounded-xl bg-white bg-opacity-10 font-semibold transition duration-200 hover:bg-opacity-20">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" class="sidebar-link flex items-center space-x-3 p-3 rounded-xl transition duration-200 hover:bg-white hover:bg-opacity-10">
                <i data-lucide="calendar" class="w-5 h-5"></i>
                <span>Monthly Stats</span>
            </a>
            <a href="#" class="sidebar-link flex items-center space-x-3 p-3 rounded-xl transition duration-200 hover:bg-white hover:bg-opacity-10">
                <i data-lucide="trophy" class="w-5 h-5"></i>
                <span>League Stats</span>
            </a>
            <a href="#" class="sidebar-link flex items-center space-x-3 p-3 rounded-xl transition duration-200 hover:bg-white hover:bg-opacity-10">
                <i data-lucide="trending-up" class="w-5 h-5"></i>
                <span>Market Stats</span>
            </a>
            <a href="#" class="sidebar-link flex items-center space-x-3 p-3 rounded-xl transition duration-200 hover:bg-white hover:bg-opacity-10">
                <i data-lucide="banknote" class="w-5 h-5"></i>
                <span>Bookmaker Stats</span>
            </a>
            <a href="#" class="sidebar-link flex items-center space-x-3 p-3 rounded-xl transition duration-200 hover:bg-white hover:bg-opacity-10">
                <i data-lucide="calendar-check" class="w-5 h-5"></i>
                <span>Event Stats</span>
            </a>
            <a href="#" class="sidebar-link flex items-center space-x-3 p-3 rounded-xl transition duration-200 hover:bg-white hover:bg-opacity-10">
                <i data-lucide="sigma" class="w-5 h-5"></i>
                <span>Complex Analysis</span>
            </a>
        </nav>

        <div class="mt-auto pt-4 border-t border-white border-opacity-10">
            <a href="#" class="flex items-center justify-center p-3 rounded-xl text-xs font-bold uppercase tracking-wider text-text-light bg-accent-2 hover:bg-accent-1/90 transition duration-200">
                <i data-lucide="rocket" class="w-4 h-4 mr-2"></i>
                CREATE PDF
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 p-4 md:p-8 overflow-auto">
        <!-- Top Header & Controls -->
        <header class="flex justify-between items-center mb-6">
            <!-- Mobile Menu Toggle Button (Hamburger) -->
            <button id="menu-toggle" class="md:hidden text-text-light hover:text-accent-1 transition mr-4">
                <i data-lucide="menu" class="w-7 h-7"></i>
            </button>
            
            <h1 class="text-2xl sm:text-3xl font-extrabold text-white flex-1">DASHBOARD</h1>
            
            <div class="flex items-center space-x-4">
                <button class="text-text-muted hover:text-white transition"><i data-lucide="search" class="w-5 h-5"></i></button>
                <button class="text-text-muted hover:text-white transition"><i data-lucide="settings" class="w-5 h-5"></i></button>
                <div class="w-8 h-8 rounded-full bg-gray-500"></div>
            </div>
        </header>

        <!-- Main Chart Section (STAKE/PL/ROI) -->
        <div class="bg-surface rounded-xl shadow-2xl p-4 md:p-6 mb-8 border border-surface/50">
            
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 border-b border-white border-opacity-10 pb-4">
                <div class="flex flex-wrap items-center space-x-2 mb-3 sm:mb-0">
                    <h2 class="text-xl font-bold text-text-light" id="main-chart-title">STAKE</h2>
                    <!-- Tab Switcher -->
                    <div id="main-tabs" class="inline-flex rounded-full bg-background p-1 text-sm text-text-muted mt-2 sm:mt-0">
                        <button data-tab="stake" class="tab-btn px-4 py-1 rounded-full font-semibold transition-colors duration-200 bg-accent-1 text-white shadow-lg">Stake</button>
                        <button data-tab="pl" class="tab-btn px-4 py-1 rounded-full font-semibold transition-colors duration-200 hover:text-white">PL</button>
                        <button data-tab="roi" class="tab-btn px-4 py-1 rounded-full font-semibold transition-colors duration-200 hover:text-white">ROI</button>
                    </div>
                </div>
                
                <!-- Time View Selector -->
                <div id="view-selector" class="inline-flex rounded-full bg-background p-1 text-xs text-text-muted">
                    <button data-view="year" class="view-btn px-3 py-1 rounded-full font-semibold transition-colors duration-200 bg-surface/50 text-white">Year</button>
                    <button data-view="month" class="view-btn px-3 py-1 rounded-full font-semibold transition-colors duration-200 hover:bg-surface/50 hover:text-white">Month</button>
                    <button data-view="week" class="view-btn px-3 py-1 rounded-full font-semibold transition-colors duration-200 hover:bg-surface/50 hover:text-white">Week</button>
                    <button data-view="day" class="view-btn px-3 py-1 rounded-full font-semibold transition-colors duration-200 hover:bg-surface/50 hover:text-white">Day</button>
                </div>
            </div>

            <div class="relative h-72 lg:h-96">
                <canvas id="mainChart"></canvas>
            </div>
        </div>
        
        <!-- Three Small Charts Section (Responsive Grid) -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            
            <!-- Chart 1: Events per Week (Line Chart) -->
            <div class="bg-surface rounded-xl p-4 shadow-xl border border-surface/50">
                <div class="flex items-center space-x-3 mb-3">
                    <div class="p-2 rounded-full bg-accent-1/20 text-accent-1">
                        <i data-lucide="calendar-heart" class="w-5 h-5"></i>
                    </div>
                    <h3 class="text-text-muted text-sm font-semibold">Total Events Tracked</h3>
                </div>
                <p class="text-2xl font-extrabold text-white mb-2" id="total-events-count">...</p>
                <div class="relative h-32">
                    <canvas id="eventsPerWeekChart"></canvas>
                </div>
            </div>

            <!-- Chart 2: Total Stake per Market Group (Bar Chart) -->
            <div class="bg-surface rounded-xl p-4 shadow-xl border border-surface/50">
                <div class="flex items-center space-x-3 mb-3">
                    <div class="p-2 rounded-full bg-accent-2/20 text-accent-2">
                        <i data-lucide="banknote" class="w-5 h-5"></i>
                    </div>
                    <h3 class="text-text-muted text-sm font-semibold">Stake per Market Group</h3>
                </div>
                <p class="text-2xl font-extrabold text-white mb-2">$ 8,500 <span class="text-text-muted text-sm font-normal"> (Weekly Avg)</span></p>
                <div class="relative h-32">
                    <canvas id="stakePerMarketChart"></canvas>
                </div>
            </div>

            <!-- Chart 3: Total ROI per Market Group (Bar Chart) -->
            <div class="bg-surface rounded-xl p-4 shadow-xl border border-surface/50 lg:col-span-1 md:col-span-2">
                <div class="flex items-center space-x-3 mb-3">
                    <div class="p-2 rounded-full bg-chart-green/20 text-chart-green">
                        <i data-lucide="percent" class="w-5 h-5"></i>
                    </div>
                    <h3 class="text-text-muted text-sm font-semibold">ROI per Market Group</h3>
                </div>
                <p class="text-2xl font-extrabold text-white mb-2">15.2% <span class="text-text-muted text-sm font-normal"> (Avg ROI)</span></p>
                <div class="relative h-32">
                    <canvas id="roiPerMarketChart"></canvas>
                </div>
            </div>
        </div>

    </div>

    <!-- Chart and Interaction Logic -->
    <script>
        // --- Sidebar Toggling Logic for Mobile ---
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const isHidden = sidebar.classList.contains('-translate-x-full');

            if (isHidden) {
                sidebar.classList.remove('-translate-x-full');
                sidebar.classList.add('translate-x-0');
                overlay.classList.remove('hidden');
                // Disable scrolling on body when menu is open
                document.body.style.overflow = 'hidden';
            } else {
                sidebar.classList.add('-translate-x-full');
                sidebar.classList.remove('translate-x-0');
                overlay.classList.add('hidden');
                // Re-enable scrolling
                document.body.style.overflow = 'auto';
            }
        }
        
        // --- Global Config ---
        const CHART_VIEWS = { YEAR: 'year', MONTH: 'month', WEEK: 'week', DAY: 'day' };
        const MARKET_GROUPS = ["CR AH", "CA AH", "CR O/U", "CA O/U"];
        let currentView = CHART_VIEWS.YEAR;
        let currentTab = 'stake';
        let mainChartInstance = null;
        let chartData = []; // Raw daily data storage

        // --- DOM Elements ---
        const mainTitleEl = document.getElementById('main-chart-title');
        const totalEventsCountEl = document.getElementById('total-events-count');
        const viewButtons = document.querySelectorAll('#view-selector .view-btn');
        const tabButtons = document.querySelectorAll('#main-tabs .tab-btn');

        // --- Data Generation Functions ---

        /** Generates mock daily data for a full year. */
        function generateMockData() {
            const data = [];
            const endDate = moment();
            const startDate = moment().subtract(365, 'days');
            const totalEvents = Math.floor(Math.random() * 500) + 1000;
            totalEventsCountEl.textContent = totalEvents.toLocaleString(); // Update DOM

            let currentDay = startDate.clone();
            while (currentDay.isBefore(endDate)) {
                const dayString = currentDay.format('YYYY-MM-DD');

                // Generate three mock metrics with different trends
                const baseStake = Math.floor(Math.random() * 20000 + 50000);
                const dailyPL = Math.floor(Math.random() * 2000 - 500);
                const dailyROI = (dailyPL / baseStake) * 100 * (1 + Math.random() * 0.5);

                data.push({
                    date: dayString,
                    stake: baseStake,
                    pl: dailyPL,
                    roi: Math.max(0, parseFloat(dailyROI.toFixed(2))),
                    events: Math.floor(Math.random() * 15 + 5) // Daily event count
                });
                currentDay.add(1, 'day');
            }
            return data;
        }

        /** Generates mock data for market group comparison charts. */
        function generateMarketData() {
            const stakeData = {};
            const roiData = {};
            
            // Generate distinct data for each market group
            MARKET_GROUPS.forEach(market => {
                // Stake: large, varying numbers
                stakeData[market] = Math.floor(Math.random() * 30000 + 5000);
                // ROI: small percentages (can be negative, but let's keep it mostly positive for the look)
                roiData[market] = parseFloat((Math.random() * 20 - 5).toFixed(1)); 
            });

            return { stakeData, roiData };
        }

        /** Aggregates the main chart data based on the selected view. */
        function aggregateData(view, metric) {
            let aggregated = {};
            let labels = [];
            let data = [];
            let unit = (metric === 'roi') ? '%' : '$';

            const filterAndGroup = (item, date) => {
                let key = '';
                switch (view) {
                    case CHART_VIEWS.YEAR:
                        key = date.format('YYYY-MM');
                        break;
                    case CHART_VIEWS.MONTH:
                        if (moment().diff(date, 'days') <= 30) {
                            key = date.format('D');
                        }
                        break;
                    case CHART_VIEWS.WEEK:
                        if (moment().diff(date, 'days') <= 7) {
                            key = date.format('ddd');
                        }
                        break;
                    case CHART_VIEWS.DAY:
                        key = item.date;
                        break;
                }
                return key;
            };

            chartData.forEach(item => {
                const date = moment(item.date);
                const key = filterAndGroup(item, date);

                if (key) {
                    if (metric === 'roi') {
                        aggregated[key] = (aggregated[key] || { sum: 0, count: 0 });
                        aggregated[key].sum += item[metric];
                        aggregated[key].count += 1;
                    } else {
                        aggregated[key] = (aggregated[key] || 0) + item[metric];
                    }
                }
            });

            labels = Object.keys(aggregated).sort();
            data = labels.map(key => {
                if (metric === 'roi') {
                    const avg = aggregated[key].sum / aggregated[key].count;
                    return parseFloat(avg.toFixed(2));
                }
                return aggregated[key];
            });

            if (view === CHART_VIEWS.YEAR) {
                labels = labels.map(key => moment(key, 'YYYY-MM').format('MMM'));
            } else if (view === CHART_VIEWS.WEEK) {
                const daysOfWeek = moment.weekdaysShort(true);
                const sortedData = daysOfWeek.map(dayKey => {
                    const index = labels.findIndex(l => l === dayKey);
                    return index !== -1 ? data[index] : 0;
                });
                labels = daysOfWeek;
                data = sortedData;
            } else if (view === CHART_VIEWS.DAY) {
                // For day view, show last 24 records (if available)
                labels = chartData.slice(-24).map(d => moment(d.date).format('MM/DD'));
                data = chartData.slice(-24).map(d => d[metric]);
            }

            return { labels, data, unit };
        }

        // --- Chart Configuration Templates ---

        function getChartConfig(type, labels, data, metric, unit, colorKey) {
            const isLine = type === 'line';
            const accentColor = tailwind.config.theme.extend.colors[colorKey] || tailwind.config.theme.extend.colors['accent-1'];

            // Determine background and border settings for neon outlines
            let backgroundColor;
            let borderWidth;
            let pointRadius = 0;

            if (isLine) {
                // Line charts use filled area under the line
                backgroundColor = accentColor + '40';
                borderWidth = 3;
                pointRadius = 5;
            } else { // Bar charts
                // Set background to transparent for the outline effect
                backgroundColor = 'transparent';
                // Set border width to make the outline visible
                borderWidth = 2; 
            }

            return {
                type: type,
                data: {
                    labels: labels,
                    datasets: [{
                        label: metric.toUpperCase(),
                        data: data,
                        borderColor: accentColor, // The outline color
                        backgroundColor: backgroundColor,
                        borderWidth: borderWidth,
                        pointRadius: pointRadius,
                        pointBackgroundColor: accentColor,
                        tension: 0.4,
                        fill: isLine ? 'origin' : false,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (c) => `${c.dataset.label}: ${unit === '$' ? '$ ' : ''}${c.parsed.y.toLocaleString()}${unit === '%' ? '%' : ''}`
                            },
                            backgroundColor: tailwind.config.theme.extend.colors['surface'],
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 14 },
                            padding: 10,
                            cornerRadius: 6,
                            borderWidth: 1,
                            borderColor: tailwind.config.theme.extend.colors['accent-1'] + '40'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: tailwind.config.theme.extend.colors['text-muted'] + '20' },
                            ticks: {
                                color: tailwind.config.theme.extend.colors['text-light'],
                                callback: (value) => unit === '$' ? (value > 1000 ? `$${(value / 1000).toFixed(0)}K` : `$${value}`) : `${value}${unit}`,
                            },
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: tailwind.config.theme.extend.colors['text-muted'] },
                        }
                    }
                }
            };
        }

        // --- Chart Rendering Functions ---

        /** Initializes or updates the Main Chart. */
        function renderMainChart() {
            const canvas = document.getElementById('mainChart');
            const { labels, data, unit } = aggregateData(currentView, currentTab);
            const colorKey = currentTab === 'pl' ? 'accent-2' : 'accent-1';

            mainTitleEl.textContent = currentTab.toUpperCase();

            const config = getChartConfig('line', labels, data, currentTab, unit, colorKey);
            config.options.scales.y.beginAtZero = false; // Stake and PL shouldn't start at 0

            if (mainChartInstance) {
                mainChartInstance.data = config.data;
                mainChartInstance.options.scales.y.ticks.callback = config.options.scales.y.ticks.callback;
                mainChartInstance.update();
            } else {
                mainChartInstance = new Chart(canvas.getContext('2d'), config);
            }
        }

        /** Renders the Events per Week chart. */
        function renderEventsChart() {
            const latestData = chartData.slice(-56); // Last 8 weeks
            
            // Group data by week number (Sun-Sat)
            const weeklyEvents = {};
            latestData.forEach(item => {
                const date = moment(item.date);
                const weekKey = date.week();
                weeklyEvents[weekKey] = (weeklyEvents[weekKey] || 0) + item.events;
            });
            
            // Adjust data to align correctly with sorted labels
            const orderedData = Object.keys(weeklyEvents).sort((a, b) => a - b).map(k => weeklyEvents[k]);
            const labels = Object.keys(weeklyEvents).sort((a, b) => a - b).map(w => `Wk ${w}`);

            const config = getChartConfig('line', labels, orderedData, 'Events', ' Events', 'accent-1');
            config.options.elements = { line: { tension: 0.2 }, point: { radius: 3 } };

            new Chart(document.getElementById('eventsPerWeekChart').getContext('2d'), config);
        }

        /** Renders the Stake and ROI per Market charts. */
        function renderMarketCharts() {
            const { stakeData, roiData } = generateMarketData();

            // --- Stake per Market Chart (Bar Chart) ---
            const stakeLabels = MARKET_GROUPS;
            const stakeValues = MARKET_GROUPS.map(m => stakeData[m]);
            const stakeConfig = getChartConfig('bar', stakeLabels, stakeValues, 'Stake', '$', 'accent-2');
            stakeConfig.options.scales.x.ticks.callback = (val) => stakeLabels[val]; 
            new Chart(document.getElementById('stakePerMarketChart').getContext('2d'), stakeConfig);

            // --- ROI per Market Chart (Bar Chart) ---
            const roiLabels = MARKET_GROUPS;
            const roiValues = MARKET_GROUPS.map(m => roiData[m]);
            const roiConfig = getChartConfig('bar', roiLabels, roiValues, 'ROI', '%', 'chart-green');
            roiConfig.options.scales.x.ticks.callback = (val) => roiLabels[val]; 
            roiConfig.options.scales.y.beginAtZero = false; // ROI can be negative
            
            new Chart(document.getElementById('roiPerMarketChart').getContext('2d'), roiConfig);
        }

        // --- Interaction Handlers ---

        function switchView(view) {
            currentView = view;
            
            viewButtons.forEach(btn => {
                const isActive = btn.dataset.view === view;
                btn.classList.toggle('bg-surface/50', isActive);
                btn.classList.toggle('text-white', isActive);
                btn.classList.toggle('hover:bg-surface/50', !isActive);
                btn.classList.toggle('text-text-muted', !isActive);
            });

            renderMainChart();
        }

        function switchTab(tab) {
            currentTab = tab;

            tabButtons.forEach(btn => {
                const isActive = btn.dataset.tab === tab;
                
                // Dynamic colors based on tab
                btn.classList.toggle('bg-accent-1', tab !== 'pl' && isActive);
                btn.classList.toggle('bg-accent-2', tab === 'pl' && isActive);
                btn.classList.toggle('text-white', isActive);
                btn.classList.toggle('shadow-lg', isActive);
                
                btn.classList.toggle('bg-transparent', !isActive);
                btn.classList.toggle('hover:text-white', !isActive);
                btn.classList.toggle('text-text-muted', !isActive);
                btn.classList.toggle('shadow-none', !isActive);
            });

            renderMainChart();
        }


        /** Application startup function. */
        async function initializeApp() {
            // 1. Initialize Firebase (optional/boilerplate)
            await window.initFirebase();

            // 2. Load Data (Currently Mocked)
            chartData = generateMockData();

            // 3. Set up Event Listeners
            document.getElementById('menu-toggle').addEventListener('click', toggleSidebar);
            document.querySelectorAll('.sidebar-link').forEach(link => {
                 link.addEventListener('click', (e) => {
                    // Close the sidebar if on a mobile screen when a link is clicked
                    if (window.innerWidth < 768) { // Tailwind's 'md' breakpoint
                        e.preventDefault(); // Prevent actual navigation for mock links
                        toggleSidebar();
                    }
                    // For a real app, you'd navigate here or update content
                });
            });

            viewButtons.forEach(button => {
                button.addEventListener('click', () => switchView(button.dataset.view));
            });
            tabButtons.forEach(button => {
                button.addEventListener('click', () => switchTab(button.dataset.tab));
            });
            
            // 4. Initial Render
            switchTab('stake');
            switchView(CHART_VIEWS.YEAR); 
            renderEventsChart();
            renderMarketCharts();

            // 5. Replace Lucide icons
            lucide.createIcons();
        }

        // Start the application when the window loads
        window.onload = initializeApp;
    </script>
</body>
</html>